generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

model User {
  id            String         @id @default(uuid())
  name          String?        @unique @default("")
  givenName     String         @default("") @map("given_name")
  familyName    String         @default("") @map("family_name")
  email         String?        @unique @default("")
  emailVerified DateTime?      @map("email_verified")
  userRole      KnowiiUserRole @default(USER) @map("user_role")
  image         String?
  createdAt     DateTime       @default(now()) @map("created_at") @db.Timestamptz(3)
  updatedAt     DateTime       @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(3)
  adminOf       Community[]    @relation("community_admins")
  memberOf      Community[]    @relation("community_members")
  ownerOf       Community[]    @relation("community_owners")

  @@index([email], map: "idx_user_email")
  @@map("users")
}

model Community {
  id          String   @id @default(uuid())
  name        String   @unique @default("")
  description String   @default("") @map("given_name")
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamptz(3)
  updatedAt   DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(3)
  admins      User[]   @relation("community_admins")
  members     User[]   @relation("community_members")
  owners      User[]   @relation("community_owners")

  @@index([name], map: "idx_community_name")
  @@map("community")
}

enum KnowiiUserRole {
  USER
  ADMIN
}
